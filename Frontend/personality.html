<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoodNight | Moon Personality Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        :root { 
            --mn-bg-color: #12121e; 
            --mn-card-bg: #1c1c28; 
        
            --mn-text-color: #ffffff; 
            --mn-accent-color: #9c27b0; 
            --mn-input-bg: #27273a; 
            --mn-input-border: #333350; 
        }
        
        body { 
            background-color: var(--mn-bg-color); 
            color: var(--mn-text-color); 
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
        }

    
        h1, h2, h3, h4, h5, h6 {
            color: var(--mn-text-color);
        }

     
        .text-muted {
            color: #adb5bd !important;
        }

        .navbar { background-color: var(--mn-card-bg); border-bottom: 1px solid var(--mn-input-border); }
        .navbar-brand, .nav-link { color: var(--mn-text-color) !important; opacity: 0.9; font-weight: 600; }
        
        .content-container { flex-grow: 1; padding-top: 50px; }
        .quiz-card { background-color: var(--mn-card-bg); border-radius: 12px; padding: 40px; box-shadow: 0 8px 24px rgba(0,0,0,0.3); max-width: 700px; margin: 0 auto; }
        
        .option-btn {
            background-color: var(--mn-input-bg); border: 1px solid var(--mn-input-border); color: var(--mn-text-color);
            padding: 15px; margin-bottom: 10px; text-align: left; transition: all 0.3s ease; width: 100%; border-radius: 8px;
        }
        .option-btn:hover { background-color: #333350; border-color: var(--mn-accent-color); transform: translateX(5px); }
        .option-btn.selected { background-color: var(--mn-accent-color); color: white; border-color: var(--mn-accent-color); }
        
        .phase-result-icon { font-size: 5rem; margin-bottom: 20px; text-shadow: 0 0 20px rgba(156, 39, 176, 0.5); }
        .progress-bar { background-color: var(--mn-accent-color); }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <script>
        if (!localStorage.getItem('userToken')) { window.location.href = 'index.html'; }
    </script>

    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid mx-5">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <span class="bg-info text-white rounded p-1 me-2" style="font-weight: 700; font-size: 1.2em;">MN</span> MoodNight
            </a>
            <div class="collapse navbar-collapse justify-content-end">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="journal.html">Journal</a></li>
                    <li class="nav-item"><a class="nav-link" href="mood.html">Mood</a></li>
                    <li class="nav-item"><a class="nav-link active" href="personality.html">Personality</a></li> 
                    <li class="nav-item"><a class="nav-link" href="tipsandawareness.html">Tips/Awareness</a></li>
                    <li class="nav-item"><a class="nav-link" href="about_us.html">About Us</a></li>
                    <li class="nav-item"><a class="nav-link" id="logoutLink" href="#">Logout</a></li>
                </ul>
            </div>
        </div>
    </nav>
    
    <div class="container content-container">
        <div id="introSection" class="text-center fade-in">
            <h1 class="mb-4">Discover Your Moon Phase ðŸŒ™</h1>
            <p class="lead text-muted mb-5">Answer these 5 questions to reveal which moon phase reflects your soul.</p>
            <button class="btn btn-outline-light px-4" onclick="startQuiz()">Start Test</button>
        </div>

        <div id="quizSection" class="d-none fade-in">
            <div class="quiz-card">
                <div class="progress mb-4" style="height: 6px; background-color: var(--mn-input-bg);">
                    <div class="progress-bar" role="progressbar" style="width: 0%" id="progressBar"></div>
                </div>
                <h4 id="questionText" class="mb-4">Question goes here...</h4>
                <div id="optionsContainer" class="d-grid gap-2"></div>
            </div>
        </div>

        <div id="resultSection" class="d-none fade-in text-center">
            <div class="quiz-card">
                <div class="phase-result-icon" id="resultIcon">ðŸŒ•</div>
                <h2 class="mb-3">You are the <span id="resultTitle" style="color: var(--mn-accent-color)">Moon Phase</span></h2>
                <p class="text-muted mb-4" id="resultDesc">Description...</p>
                
                <div class="d-flex justify-content-center gap-2 flex-wrap">
                    <button id="saveResultBtn" class="btn btn-outline-light px-4">Save to Profile</button>
                    <button id="retakeTestBtn" class="btn btn-outline-light px-4" onclick="retakeTest()">Retake Test</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Data
        const questions = [
            { text: "When you walk into a crowded room, what is your instinct?", options: [{ text: "I immediately look for friends and start chatting.", type: "E" }, { text: "I find a quiet corner to observe first.", type: "I" }, { text: "I scan for opportunities or interesting connections.", type: "G" }, { text: "I feel overwhelmed and check the exits.", type: "R" }] },
            { text: "How do you handle a new project?", options: [{ text: "I dive in with high energy immediately.", type: "G" }, { text: "I plan carefully in solitude before starting.", type: "I" }, { text: "I rally a team to do it together.", type: "E" }, { text: "I finish old tasks before starting new ones.", type: "R" }] },
            { text: "Your ideal Friday night is:", options: [{ text: "A big party with loud music.", type: "E" }, { text: "Reading a book or meditating.", type: "I" }, { text: "Working on a side hustle or hobby.", type: "G" }, { text: "A deep conversation with one close friend.", type: "R" }] },
            { text: "How do you deal with failure?", options: [{ text: "I reflect on what went wrong privately.", type: "I" }, { text: "I vent to everyone I know.", type: "E" }, { text: "I immediately try again, harder.", type: "G" }, { text: "I accept it as a lesson and let it go.", type: "R" }] },
            { text: "Which word resonates with you most right now?", options: [{ text: "Shine", type: "E" }, { text: "Mystery", type: "I" }, { text: "Growth", type: "G" }, { text: "Wisdom", type: "R" }] }
        ];

        const personalities = {
            "E": { title: "Full Moon", desc: "You are radiant, expressive, and full of energy. You illuminate the darkness for others and thrive in social settings.", emoji: "ðŸŒ•" }, 
            "I": { title: "New Moon", desc: "You are introspective, full of potential, and mysterious. You find power in silence and new beginnings.", emoji: "ðŸŒ‘" }, 
            "G": { title: "Waxing Moon", desc: "You are ambitious and constantly growing. You are action-oriented and always building towards your dreams.", emoji: "ðŸŒ“" }, 
            "R": { title: "Waning Moon", desc: "You are wise, reflective, and good at letting go. You understand that every ending is a preparation for a new start.", emoji: "ðŸŒ—" }
        };

      
        let currentQuestion = 0;
        let scores = { E: 0, I: 0, G: 0, R: 0 };

   
        const introSec = document.getElementById('introSection');
        const quizSec = document.getElementById('quizSection');
        const resultSec = document.getElementById('resultSection');
        const questionText = document.getElementById('questionText');
        const optionsContainer = document.getElementById('optionsContainer');
        const progressBar = document.getElementById('progressBar');
        const saveBtn = document.getElementById('saveResultBtn');
   

        function startQuiz() {
            introSec.classList.add('d-none');
            quizSec.classList.remove('d-none');
            renderQuestion();
        }

        function renderQuestion() {
            const q = questions[currentQuestion];
            questionText.textContent = q.text;
            optionsContainer.innerHTML = '';
            const progress = ((currentQuestion) / questions.length) * 100;
            progressBar.style.width = `${progress}%`;

            q.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = opt.text;
                btn.onclick = () => handleAnswer(opt.type);
                optionsContainer.appendChild(btn);
            });
        }

        function handleAnswer(type) {
            scores[type]++;
            currentQuestion++;
            if (currentQuestion < questions.length) renderQuestion();
            else showResult();
        }

        function showResult() {
            quizSec.classList.add('d-none');
            resultSec.classList.remove('d-none');
            progressBar.style.width = '100%';

            const resultType = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
            const resultData = personalities[resultType];

            document.getElementById('resultTitle').textContent = resultData.title;
            document.getElementById('resultDesc').textContent = resultData.desc;
            document.getElementById('resultIcon').textContent = resultData.emoji; 

        
            saveBtn.onclick = () => saveResultToBackend(resultData.title, resultData.desc);
            
           
        }

       

        async function saveResultToBackend(phase, desc) {
            const token = localStorage.getItem('userToken');
            if (!token) return;

            saveBtn.disabled = true;
            saveBtn.textContent = 'Saving...';

            try {
                const response = await fetch('/api/personality', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                   
                    body: JSON.stringify({ moon_phase: phase, description: desc }) 
                });

                if (response.ok) {
                    saveBtn.textContent = 'Saved!';
                    saveBtn.classList.replace('btn-outline-light', 'btn-success');
                } else {
                    saveBtn.textContent = 'Error Saving';
                    saveBtn.disabled = false;
                }
            } catch (error) {
                console.error('Error:', error);
                saveBtn.textContent = 'Network Error';
            }
        }

     
        function retakeTest() {
           
            currentQuestion = 0;
            scores = { E: 0, I: 0, G: 0, R: 0 };
            
            
            resultSec.classList.add('d-none');
            introSec.classList.remove('d-none');
            
          
            saveBtn.textContent = 'Save to Profile';
            saveBtn.classList.replace('btn-success', 'btn-outline-light');
            saveBtn.disabled = false;
            
            
            progressBar.style.width = '0%';
        }


        document.getElementById('logoutLink').addEventListener('click', (e) => {
            e.preventDefault();
            localStorage.clear();
            window.location.href = 'index.html';
        });
    </script>
</body>
</html>